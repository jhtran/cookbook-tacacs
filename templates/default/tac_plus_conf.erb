# Generated by Chef.
# Local modifications will be overwritten.

accounting file = <%= node['tacacs']['acct_log_path'] %>

<% if node['tacacs']['tac_key'] -%>
key = <%= node['tacacs']['tac_key'] %>
<% end -%>

<% ! @admins.empty? && @admins.each do |admin| -%>
user = <%= admin %> {
    member = admin
}
<% end -%>

<% ! @viewers.empty? && @viewers.each do |viewer| -%>
  <%- if node['tacacs']['robot']['username'] && viewer != node['tacacs']['robot']['username'] -%>
user = <%= viewer %> {
    member = viewonly
}
  <% end -%>
<% end -%>

<% if node['tacacs']['robot']['username'] -%>
user = <%= node['tacacs']['robot']['username'] %> {
    login = cleartext <%= @user_creds['password'] %>
    cmd = show { permit .* }
    cmd = copy { permit .* }
    cmd = enable { permit .* }
    service = exec { priv-lvl = 10 }
    cmd = routing-context { permit .* }
    cmd = bash { permit .* }
    cmd = sudo { permit .* }
    cmd = ip { permit .* }
}
<% end -%>


group = admin {
    default service = permit
    login = PAM
    service = exec {
        priv-lvl = 15
    }
}

group = viewonly {
    default service = deny
    login = PAM
    cmd = show { permit .* }
    cmd = copy { permit .* }
    cmd = enable { permit .* }
    cmd = terminal { permit .* }
    service = exec { priv-lvl = 10 }
    cmd = routing-context { permit .* }
    cmd = bash { permit .* }
    cmd = ip { permit .* }
}
